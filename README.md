# Smart-Home
## Описание задачи
Небольшая компания, организующая удалённое управление отоплением в доме, получила заказ на создание экосистемы умных поселков на территории нескольких регионов страны. Необходимые датчики и реле установлены лишь в половине домов, желающих подключиться к целевой экосистеме.
Состояние компании в настоящий момент не позволяет в полной мере реализовать новые бизнес-цели: расширять функционал и масштабироваться. Для этого требуется пересмотр и оптимизация всей экосистемы.
### Текущее решение из задачи:
Текущее решение компании:
- Нынешнее положение компании позволяет только управлять отоплением в доме и проверять температуру.
- Каждая установка сопровождается выездом специалиста по подключению системы отопления в доме к текущей версии системы.
- Архитектура компании представляет из себя монолит на Java с СУБД Postgres. Всё синхронно. Никаких асинхронных вызовов, микросервисов и реактивного взаимодействия в системе нет. Всё управление идёт от сервера к датчику. Данные о температуре также получаются через запрос от сервера к датчику.
- Самостоятельно подключить свой датчик к системе пользователь не может.
### Техническое описание:
Smart-home-monolith - приложение, представляет собой монолит, который можно разделить на:
- контроллер
- репозиторий
- сервис

Приложение предоставляет следующий технический функционал:
   * `GET /api/heating/{id}` - Получить данные от датчика по его уникальному идентификатору
   * `PUT /api/heating/{id}` - Обновить данные от датчика по его уникальному идентификатору
   * `POST /api/heating/{id}/turn-on` - Отправить команду на включение датчика по его уникальному идентификатору
   * `POST /api/heating/{id}/turn-off` - Отправить команду на отключение датчика по его уникальному идентификатору
   * `GET /api/heating/{id}/current-temperature` - Узнать текущую температуру датчика по его уникальному идентификатору
   * `POST /api/heating/{id}/current-temperature` - Установить целевое значение для температуры датчика по его уникальному идентификатору

Функционал взаимодействует с БД PostgreSQL через таблицы:
* heating_systems
* temperature_sensors

### Домены монолитного приложения:
* Управления пользователями
* Мониторинга температуры
* Управления устройствами

### Архитектура AS IS
* [Context](documents/C4/context/smart-home-monolith.puml)
* [Context (DDD)](documents/C4/context/smart-home-monolith-domain.puml)
------------
## To BE

### Архитектура C4:
* [Container](documents/C4/container/smart-home-ms-container.puml)
* [Component](documents/C4/component/smart-home-ms-component.puml)
* [Code](documents/C4/code)
* [ER model](documents/other/er-model.puml)
* [ER model целевое состояние](documents/other/er-model-target.puml)
* [Swagger](documents/other/swagger.yaml)

#### Описание [ER model целевое состояние](documents/other/er-model-target.puml)
* Сущность Role (Роль) - характеризует бизнес-роль клиента для своего дома. Например "Мама", "Папа", "Муж", "Жена"
* Сущность User (Пользователь) - характеризует пользователя/клиента
* Сущность UserRole (Пользователь с ролью) - представляет собой сущность-связь M к N (многие ко многим) между сущностями Role и User
* Сущность House (Дом) - характеризует дом пользователя
* Сущность Module (Модуль управления) - характеризует модуль управления, который предназначен для сбора телеметрии от датчиков, передачи/приема команд с датчиков
* Сущность ModuleType (Тип модуля) - характеризует тип модуля управления. К примеру модуль-1 может управлять датчиками температуры и влажности, но не может управлять замками
* Сущность Record (Запись) - характеризует видеозапись передаваемую с камер-видеонаблюдений и сохраняемую в объектное хранилище S3
* Сущность Command (Команда) - характеризует команду, которая может быть передана модулю для выполнения ее датчиком
* Сущность ModuleCommand (Команда модулю) - представляет собой сущность-связь сущность-связь M к N (многие ко многим) между сущностями Command и Module и характеризует команду, которая была передана на исполнению модулю для выполнения ее датчиком
* Сущность Device (Устройство) - характеризует устройство или датчик используемый как компонент IoT
* Сущность DeviceType (Тип устройства) - характеризует тип устройства. Пример: "Датчик температуры", "Датчик влажности", "Камера-видеонаблюдения"
* Сущность DeviceOperation (Действие устройству) - представляет собой сущность-связь сущность-связь M к N (многие ко многим) между сущностями Module и Device и характеризует действия переданные модулем управления -  устройству и результат их выполнения
* Сущность MonitoringProgram (Настройка мониторинга) - характеризует эталонные/пороговые значения показателей устройства для выполнения бизнес-сценария мониторинга состояния устройства
* Сущность Telemetry (Телеметрия) - характеризует телеметрию передаваемую от устройства



### Основные сервисы целевой системы

#### User Management Service
Управляет данными о пользователях
#### Device Control Service
Управляет устройствами умного дома
#### Telemetry Service
Собирает телеметрию
#### Monitoring Service
Производит мониторинг показателей устройств
#### Device Register Service
Регистрирует устройства пользователя
#### Notification Service
Уведомляет пользователя о состоянии устройств и командах устройствам
#### API GateWay
Реализует подход "Единой точки входа"
#### Kafka
Брокер очередей для ассинхронного обмена между компонентами
### Основные контейнеры

# Запуск
1. Поднять контейнеры
```bash
docker-compose up -d
```
2. Наполнить данными
```bash
.\init_data.sh
```
3. Проверь реализацию через Postman
4. Остановить контейнеры
```bash
docker-compose down
```

P.S. [Можно проверить через Swagger UI](http://localhost:8085/swagger-ui)

P.S.S [cAdvisor доступен по адресу](http://localhost:8080/containers/)